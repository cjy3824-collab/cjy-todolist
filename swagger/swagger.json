
{
  "openapi": "3.0.0",
  "info": {
    "title": "cjy-todoList API",
    "version": "1.0",
    "description": "사용자 인증 기반의 개인 할 일 관리 웹 애플리케이션 cjy-todoList의 API 명세서입니다."
  },
  "servers": [
    {
      "url": "/api"
    }
  ],
  "tags": [
    { "name": "Auth", "description": "사용자 인증 관련 API" },
    { "name": "Users", "description": "사용자 정보 관련 API" },
    { "name": "Todos", "description": "할 일 관리 API" },
    { "name": "Trash", "description": "휴지통 관련 API" },
    { "name": "Calendar", "description": "캘린더 뷰 관련 API" },
    { "name": "Holidays", "description": "국경일 관리 API" }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "회원가입",
        "description": "새로운 사용자를 등록합니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/RegisterRequest" }
            }
          }
        },
        "responses": {
          "201": { "description": "회원가입 성공" },
          "400": { "description": "잘못된 요청 (입력값 오류)" },
          "409": { "description": "이미 존재하는 사용자명 또는 이메일" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "로그인",
        "description": "사용자 인증 후 Access Token과 Refresh Token을 발급합니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "로그인 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TokenResponse" }
              }
            }
          },
          "401": { "description": "인증 실패" }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "로그아웃",
        "security": [{ "bearerAuth": [] }],
        "description": "사용자 세션을 종료하고 토큰을 무효화합니다.",
        "responses": {
          "200": { "description": "로그아웃 성공" }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Auth"],
        "summary": "토큰 갱신",
        "description": "Refresh Token을 사용하여 새로운 Access Token을 발급받습니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/RefreshRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "토큰 갱신 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TokenResponse" }
              }
            }
          },
          "401": { "description": "유효하지 않은 Refresh Token" }
        }
      }
    },
    "/users/profile": {
      "get": {
        "tags": ["Users"],
        "summary": "사용자 프로필 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "현재 로그인된 사용자의 프로필 정보를 조회합니다.",
        "responses": {
          "200": {
            "description": "프로필 조회 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Users"],
        "summary": "사용자 프로필 수정",
        "security": [{ "bearerAuth": [] }],
        "description": "현재 로그인된 사용자의 프로필(이메일, 비밀번호)을 수정합니다.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UpdateUserRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "프로필 수정 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "400": { "description": "잘못된 요청" }
        }
      }
    },
    "/todos": {
      "get": {
        "tags": ["Todos"],
        "summary": "할 일 목록 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "사용자의 할 일 목록을 필터링, 정렬하여 조회합니다. 국경일 정보도 포함됩니다.",
        "parameters": [
          { "in": "query", "name": "startDate", "schema": { "type": "string", "format": "date" }, "description": "조회 시작일" },
          { "in": "query", "name": "endDate", "schema": { "type": "string", "format": "date" }, "description": "조회 종료일" },
          { "in": "query", "name": "isCompleted", "schema": { "type": "boolean" }, "description": "완료 여부" },
          { "in": "query", "name": "keyword", "schema": { "type": "string" }, "description": "검색 키워드" }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Todo" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Todos"],
        "summary": "할 일 생성",
        "security": [{ "bearerAuth": [] }],
        "description": "새로운 할 일을 생성합니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateTodoRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "생성 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Todo" }
              }
            }
          },
          "400": { "description": "잘못된 요청" }
        }
      }
    },
    "/todos/{id}": {
      "parameters": [
        { "in": "path", "name": "id", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "Todo ID" }
      ],
      "get": {
        "tags": ["Todos"],
        "summary": "할 일 상세 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "특정 할 일의 상세 정보를 조회합니다.",
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Todo" }
              }
            }
          },
          "404": { "description": "존재하지 않는 할 일" }
        }
      },
      "put": {
        "tags": ["Todos"],
        "summary": "할 일 수정",
        "security": [{ "bearerAuth": [] }],
        "description": "특정 할 일의 정보를 수정합니다. 완료된 할 일은 수정할 수 없습니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UpdateTodoRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "수정 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Todo" }
              }
            }
          },
          "400": { "description": "잘못된 요청 (완료된 할 일 등)" },
          "404": { "description": "존재하지 않는 할 일" }
        }
      },
      "delete": {
        "tags": ["Todos"],
        "summary": "할 일 삭제 (휴지통으로)",
        "security": [{ "bearerAuth": [] }],
        "description": "할 일을 휴지통으로 이동합니다(Soft delete). 완료된 할 일은 삭제할 수 없습니다.",
        "responses": {
          "200": { "description": "삭제 성공" },
          "400": { "description": "잘못된 요청 (완료된 할 일 등)" },
          "404": { "description": "존재하지 않는 할 일" }
        }
      }
    },
    "/todos/{id}/complete": {
      "patch": {
        "tags": ["Todos"],
        "summary": "할 일 완료 상태 토글",
        "security": [{ "bearerAuth": [] }],
        "description": "할 일의 완료/미완료 상태를 변경합니다.",
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "Todo ID" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ToggleCompleteRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "상태 변경 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Todo" }
              }
            }
          },
          "404": { "description": "존재하지 않는 할 일" }
        }
      }
    },
    "/trash": {
      "get": {
        "tags": ["Trash"],
        "summary": "휴지통 목록 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "휴지통에 있는(삭제된) 할 일 목록을 조회합니다.",
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Todo" }
                }
              }
            }
          }
        }
      }
    },
    "/trash/{id}/restore": {
      "post": {
        "tags": ["Trash"],
        "summary": "할 일 복구",
        "security": [{ "bearerAuth": [] }],
        "description": "휴지통의 할 일을 원래 상태로 복구합니다.",
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "Todo ID" }
        ],
        "responses": {
          "200": { "description": "복구 성공" },
          "404": { "description": "존재하지 않는 할 일" }
        }
      }
    },
    "/trash/{id}": {
      "delete": {
        "tags": ["Trash"],
        "summary": "할 일 영구 삭제",
        "security": [{ "bearerAuth": [] }],
        "description": "휴지통의 할 일을 데이터베이스에서 영구적으로 삭제합니다.",
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "Todo ID" }
        ],
        "responses": {
          "200": { "description": "영구 삭제 성공" },
          "404": { "description": "존재하지 않는 할 일" }
        }
      }
    },
    "/calendar": {
      "get": {
        "tags": ["Calendar"],
        "summary": "월별 캘린더 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "특정 연도와 월에 해당하는 할 일 및 국경일 정보를 캘린더 형식으로 조회합니다.",
        "parameters": [
          { "in": "query", "name": "year", "required": true, "schema": { "type": "integer" }, "description": "조회할 연도" },
          { "in": "query", "name": "month", "required": true, "schema": { "type": "integer" }, "description": "조회할 월" }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/CalendarDay" }
                }
              }
            }
          }
        }
      }
    },
    "/calendar/date/{date}": {
      "get": {
        "tags": ["Calendar"],
        "summary": "특정 날짜의 할 일 조회",
        "security": [{ "bearerAuth": [] }],
        "description": "특정 날짜를 만료일로 갖는 할 일 목록을 조회합니다.",
        "parameters": [
          { "in": "path", "name": "date", "required": true, "schema": { "type": "string", "format": "date" }, "description": "조회할 날짜 (YYYY-MM-DD)" }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Todo" }
                }
              }
            }
          }
        }
      }
    },
    "/holidays": {
      "get": {
        "tags": ["Holidays"],
        "summary": "국경일 목록 조회",
        "description": "모든 사용자가 볼 수 있는 국경일 목록을 조회합니다.",
        "parameters": [
          { "in": "query", "name": "year", "schema": { "type": "integer" }, "description": "조회할 연도 (지정하지 않으면 모든 국경일)" }
        ],
        "responses": {
          "200": {
            "description": "조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Todo" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Holidays"],
        "summary": "국경일 생성 (관리자)",
        "security": [{ "bearerAuth": [] }],
        "description": "관리자만 새로운 국경일을 생성할 수 있습니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateHolidayRequest" }
            }
          }
        },
        "responses": {
          "201": { "description": "생성 성공" },
          "401": { "description": "인증 실패" },
          "403": { "description": "권한 없음 (관리자가 아님)" }
        }
      }
    },
    "/holidays/{id}": {
      "parameters": [
        { "in": "path", "name": "id", "required": true, "schema": { "type": "string", "format": "uuid" }, "description": "Holiday(Todo) ID" }
      ],
      "put": {
        "tags": ["Holidays"],
        "summary": "국경일 수정 (관리자)",
        "security": [{ "bearerAuth": [] }],
        "description": "관리자만 국경일 정보를 수정할 수 있습니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateHolidayRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "수정 성공" },
          "401": { "description": "인증 실패" },
          "403": { "description": "권한 없음" },
          "404": { "description": "존재하지 않는 국경일" }
        }
      },
      "delete": {
        "tags": ["Holidays"],
        "summary": "국경일 삭제 (관리자)",
        "security": [{ "bearerAuth": [] }],
        "description": "관리자만 국경일을 삭제할 수 있습니다.",
        "responses": {
          "200": { "description": "삭제 성공" },
          "401": { "description": "인증 실패" },
          "403": { "description": "권한 없음" },
          "404": { "description": "존재하지 않는 국경일" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "userId": { "type": "string", "format": "uuid" },
          "username": { "type": "string", "maxLength": 50 },
          "email": { "type": "string", "format": "email", "maxLength": 100 },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "Todo": {
        "type": "object",
        "properties": {
          "todoId": { "type": "string", "format": "uuid" },
          "userId": { "type": "string", "format": "uuid", "nullable": true },
          "title": { "type": "string", "maxLength": 200 },
          "description": { "type": "string", "maxLength": 2000, "nullable": true },
          "startDate": { "type": "string", "format": "date", "nullable": true },
          "dueDate": { "type": "string", "format": "date", "nullable": true },
          "isCompleted": { "type": "boolean", "default": false },
          "isPublicHoliday": { "type": "boolean", "default": false },
          "isDeleted": { "type": "boolean", "default": false },
          "deletedAt": { "type": "string", "format": "date-time", "nullable": true },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "CalendarDay": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "format": "date" },
          "todos": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Todo" }
          },
          "holidays": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Todo" }
          }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": ["username", "email", "password"],
        "properties": {
          "username": { "type": "string", "maxLength": 50 },
          "email": { "type": "string", "format": "email", "maxLength": 100 },
          "password": { "type": "string", "format": "password", "minLength": 8 }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["email", "password"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "format": "password" }
        }
      },
      "TokenResponse": {
        "type": "object",
        "properties": {
          "accessToken": { "type": "string" },
          "refreshToken": { "type": "string" }
        }
      },
      "RefreshRequest": {
        "type": "object",
        "required": ["refreshToken"],
        "properties": {
          "refreshToken": { "type": "string" }
        }
      },
      "UpdateUserRequest": {
        "type": "object",
        "properties": {
          "email": { "type": "string", "format": "email", "maxLength": 100 },
          "password": { "type": "string", "format": "password", "minLength": 8 }
        }
      },
      "CreateTodoRequest": {
        "type": "object",
        "required": ["title"],
        "properties": {
          "title": { "type": "string", "maxLength": 200 },
          "description": { "type": "string", "maxLength": 2000 },
          "startDate": { "type": "string", "format": "date" },
          "dueDate": { "type": "string", "format": "date" }
        }
      },
      "UpdateTodoRequest": {
        "type": "object",
        "properties": {
          "title": { "type": "string", "maxLength": 200 },
          "description": { "type": "string", "maxLength": 2000 },
          "startDate": { "type": "string", "format": "date" },
          "dueDate": { "type": "string", "format": "date" }
        }
      },
      "ToggleCompleteRequest": {
        "type": "object",
        "required": ["isCompleted"],
        "properties": {
          "isCompleted": { "type": "boolean" }
        }
      },
      "CreateHolidayRequest": {
        "type": "object",
        "required": ["title", "dueDate"],
        "properties": {
          "title": { "type": "string", "maxLength": 200 },
          "dueDate": { "type": "string", "format": "date" }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ]
}
